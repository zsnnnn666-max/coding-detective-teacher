<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¼–ç æ¢ç§˜å°ä¾¦æ¢ - æ•™å¸ˆç«¯</title>
    <style>
        body { font-family: "Microsoft YaHei", Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .container { display: flex; gap: 20px; flex-wrap: wrap; }
        .sidebar { flex: 1; min-width: 300px; background: #f8f9fa; border-radius: 8px; padding: 20px; }
        .main-content { flex: 3; min-width: 600px; background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; }
        .student-item { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .student-item:hover { background: #e9ecef; }
        .student-item.active { background: #e3f2fd; font-weight: bold; }
        .medal { color: #f1c40f; margin-right: 5px; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
        .stat-value { font-size: 28px; font-weight: bold; color: #3498db; }
        .activity-status { margin: 8px 0; }
        .completed { color: #27ae60; }
        .uncompleted { color: #e74c3c; }
    </style>
</head>
<body>
    <h1>ç¼–ç æ¢ç§˜å°ä¾¦æ¢ - æ•™å¸ˆç®¡ç†ç³»ç»Ÿ</h1>

    <div class="container">
        <!-- å·¦ä¾§ï¼šå­¦ç”Ÿåˆ—è¡¨ + ç»Ÿè®¡ -->
        <div class="sidebar">
            <div class="stat-card">
                <h3>æ€»å­¦ç”Ÿæ•°</h3>
                <div class="stat-value" id="totalStudents">0</div>
            </div>
            <div class="stat-card">
                <h3>å¹³å‡å‹‹ç« æ•°</h3>
                <div class="stat-value" id="avgMedals">0</div>
            </div>
            <h2>å­¦ç”Ÿåˆ—è¡¨</h2>
            <div id="studentList">åŠ è½½ä¸­å­¦ç”Ÿæ•°æ®...</div>
        </div>

        <!-- å³ä¾§ï¼šå­¦ç”Ÿè¯¦æƒ… -->
        <div class="main-content">
            <h2 id="detailTitle">è¯·é€‰æ‹©å­¦ç”ŸæŸ¥çœ‹è¯¦æƒ…</h2>
            <div id="detailContent">
                <p>é€‰æ‹©å­¦ç”Ÿåï¼Œå°†å®æ—¶æ˜¾ç¤ºå…¶æ´»åŠ¨å®Œæˆæƒ…å†µå’Œå‹‹ç« è·å¾—æƒ…å†µ</p>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
    <script>
        // æ›¿æ¢ä¸ºä½ çš„ Firebase é…ç½®ï¼ˆå’Œå­¦ç”Ÿç«¯å®Œå…¨ä¸€è‡´ï¼ï¼‰
        const firebaseConfig = {
            <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCRX5wRcB8OqEkCIUxVfdqC4F9K3tgLyOY",
    authDomain: "teacher-1c88c.firebaseapp.com",
    databaseURL: "https://teacher-1c88c-default-rtdb.firebaseio.com",
    projectId: "teacher-1c88c",
    storageBucket: "teacher-1c88c.firebasestorage.app",
    messagingSenderId: "1005145815446",
    appId: "1:1005145815446:web:a8be89b820afa81a0f85b7"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
</script>
        };

        // åˆå§‹åŒ– Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let students = [];

        // å®æ—¶ç›‘å¬å­¦ç”Ÿæ•°æ®å˜åŒ–
        db.ref("students").on("value", snapshot => {
            const data = snapshot.val();
            students = data ? Object.values(data) : [];
            renderStudentList();
            updateStats();
            // ä¿æŒå½“å‰é€‰ä¸­å­¦ç”Ÿçš„è¯¦æƒ…
            const activeStudent = document.querySelector(".student-item.active");
            if (activeStudent && students.length > 0) {
                const activeName = activeStudent.querySelector("span").textContent;
                const student = students.find(s => s.name === activeName);
                if (student) showStudentDetail(student);
            }
        });

        // æ¸²æŸ“å­¦ç”Ÿåˆ—è¡¨
        function renderStudentList() {
            const listElem = document.getElementById("studentList");
            if (students.length === 0) {
                listElem.textContent = "æš‚æ— å­¦ç”Ÿæ•°æ®";
                return;
            }
            listElem.innerHTML = "";
            students.forEach(student => {
                const div = document.createElement("div");
                div.className = "student-item";
                div.innerHTML = `<span>${student.name}</span><span>å‹‹ç« ï¼š${student.medals.length}ä¸ª</span>`;
                div.onclick = () => {
                    document.querySelectorAll(".student-item").forEach(item => item.classList.remove("active"));
                    div.classList.add("active");
                    showStudentDetail(student);
                };
                listElem.appendChild(div);
            });
        }

        // æ˜¾ç¤ºå­¦ç”Ÿè¯¦æƒ…
        function showStudentDetail(student) {
            document.getElementById("detailTitle").textContent = `å­¦ç”Ÿè¯¦æƒ…ï¼š${student.name}`;
            let detailHtml = `
                <p><strong>æœ€åæ›´æ–°ï¼š</strong>${student.lastUpdated}</p>
                <p><strong>è·å¾—å‹‹ç« ï¼š</strong>
                    ${student.medals.map(m => `<span class="medal">ğŸ…</span>æ´»åŠ¨${m}`).join(" ")}ï¼ˆå…±${student.medals.length}ä¸ªï¼‰
                </p>
                <h3>æ´»åŠ¨å®Œæˆæƒ…å†µï¼š</h3>
                <div class="activity-status">æ´»åŠ¨ä¸€ï¼š${student.activities[1] ? '<span class="completed">âœ… å·²å®Œæˆ</span>' : '<span class="uncompleted">âŒ æœªå®Œæˆ</span>'}</div>
                <div class="activity-status">æ´»åŠ¨äºŒï¼š${student.activities[2] ? '<span class="completed">âœ… å·²å®Œæˆ</span>' : '<span class="uncompleted">âŒ æœªå®Œæˆ</span>'}</div>
                <div class="activity-status">æ´»åŠ¨ä¸‰ï¼š${student.activities[3] ? '<span class="completed">âœ… å·²å®Œæˆ</span>' : '<span class="uncompleted">âŒ æœªå®Œæˆ</span>'}</div>
                <div class="activity-status">æ´»åŠ¨å››ï¼š${student.activities[4] ? '<span class="completed">âœ… å·²å®Œæˆ</span>' : '<span class="uncompleted">âŒ æœªå®Œæˆ</span>'}</div>
                <div class="activity-status">æ´»åŠ¨äº”ï¼š${student.activities[5] ? '<span class="completed">âœ… å·²å®Œæˆ</span>' : '<span class="uncompleted">âŒ æœªå®Œæˆ</span>'}</div>
            `;
            document.getElementById("detailContent").innerHTML = detailHtml;
        }

        // æ›´æ–°ç­çº§ç»Ÿè®¡
        function updateStats() {
            document.getElementById("totalStudents").textContent = students.length;
            if (students.length === 0) {
                document.getElementById("avgMedals").textContent = "0";
                return;
            }
            const totalMedals = students.reduce((sum, s) => sum + s.medals.length, 0);
            document.getElementById("avgMedals").textContent = (totalMedals / students.length).toFixed(1);
        }
    </script>
</body>
</html>
